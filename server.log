INFO:     Started server process [37447]
INFO:     Waiting for application startup.
{"timestamp": "2025-11-12T18:34:05.817198Z", "level": "info", "event": "Starting RAG service..."}
{"timestamp": "2025-11-12T18:34:05.817453Z", "level": "info", "event": "Running in LOCAL mode: .env loaded"}
{"timestamp": "2025-11-12T18:34:05.817488Z", "level": "info", "event": "Loaded GOOGLE_API_KEY from individual env var"}
{"keys": {"GOOGLE_API_KEY": "AIzaSy..."}, "timestamp": "2025-11-12T18:34:05.817516Z", "level": "info", "event": "API keys loaded"}
{"config_keys": ["faiss_db", "embedding_model", "retriever", "llm"], "timestamp": "2025-11-12T18:34:05.818302Z", "level": "info", "event": "YAML config loaded"}
{"model": "models/text-embedding-004", "timestamp": "2025-11-12T18:34:05.818358Z", "level": "info", "event": "Loading embedding model"}
{"index_dir": "faiss_index", "timestamp": "2025-11-12T18:34:05.834611Z", "level": "info", "event": "VectorStoreManager initialized"}
{"timestamp": "2025-11-12T18:34:05.834714Z", "level": "info", "event": "Loading vector store"}
Loading faiss.
Successfully loaded faiss.
Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
{"timestamp": "2025-11-12T18:34:05.862777Z", "level": "info", "event": "Vector store loaded"}
{"timestamp": "2025-11-12T18:34:05.862974Z", "level": "info", "event": "Running in LOCAL mode: .env loaded"}
{"timestamp": "2025-11-12T18:34:05.863003Z", "level": "info", "event": "Loaded GOOGLE_API_KEY from individual env var"}
{"keys": {"GOOGLE_API_KEY": "AIzaSy..."}, "timestamp": "2025-11-12T18:34:05.863026Z", "level": "info", "event": "API keys loaded"}
{"config_keys": ["faiss_db", "embedding_model", "retriever", "llm"], "timestamp": "2025-11-12T18:34:05.863414Z", "level": "info", "event": "YAML config loaded"}
{"provider": "google", "model": "models/gemini-2.5-pro-preview-03-25", "timestamp": "2025-11-12T18:34:05.863444Z", "level": "info", "event": "Loading LLM"}
{"timestamp": "2025-11-12T18:34:05.865302Z", "level": "info", "event": "Running in LOCAL mode: .env loaded"}
{"timestamp": "2025-11-12T18:34:05.865342Z", "level": "info", "event": "Loaded GOOGLE_API_KEY from individual env var"}
{"keys": {"GOOGLE_API_KEY": "AIzaSy..."}, "timestamp": "2025-11-12T18:34:05.865367Z", "level": "info", "event": "API keys loaded"}
{"config_keys": ["faiss_db", "embedding_model", "retriever", "llm"], "timestamp": "2025-11-12T18:34:05.865707Z", "level": "info", "event": "YAML config loaded"}
{"provider": "google", "model": "models/gemini-2.5-pro-preview-03-25", "timestamp": "2025-11-12T18:34:05.865738Z", "level": "info", "event": "Loading LLM"}
{"timestamp": "2025-11-12T18:34:05.866062Z", "level": "info", "event": "QueryExpander initialized"}
{"num_documents": 522, "timestamp": "2025-11-12T18:34:05.874490Z", "level": "info", "event": "BM25 index built"}
Use pytorch device: mps
{"timestamp": "2025-11-12T18:34:07.973082Z", "level": "info", "event": "Reranker loaded"}
{"timestamp": "2025-11-12T18:34:07.981803Z", "level": "info", "event": "RAG chain built"}
{"top_k": 20, "rerank_top_k": 10, "timestamp": "2025-11-12T18:34:07.981937Z", "level": "info", "event": "HybridBoeingRAGService initialized"}
{"timestamp": "2025-11-12T18:34:07.981995Z", "level": "info", "event": "Service started"}
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
============================================================
Boeing 737 Manual RAG Service
============================================================
Server: http://0.0.0.0:8000
Docs: http://0.0.0.0:8000/docs
============================================================

INFO:     127.0.0.1:54102 - "GET /health HTTP/1.1" 200 OK
INFO:     127.0.0.1:54325 - "GET /health HTTP/1.1" 200 OK
{"q": "I'm calculating our takeoff weight for a dry runway. We're at 2,000 feet pressure altitude, and the ", "timestamp": "2025-11-12T18:38:49.757244Z", "level": "info", "event": "Processing query"}
{"num_expansions": 3, "timestamp": "2025-11-12T18:39:08.855954Z", "level": "info", "event": "Query expanded"}
{"dense": 20, "bm25": 20, "timestamp": "2025-11-12T18:39:09.368738Z", "level": "info", "event": "Hybrid retrieval done"}
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  1.30it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  1.30it/s]
{"docs": 10, "timestamp": "2025-11-12T18:39:10.386074Z", "level": "info", "event": "Reranking done"}
{"pages": 0, "timestamp": "2025-11-12T18:39:34.239751Z", "level": "info", "event": "Query done"}
INFO:     127.0.0.1:54327 - "POST /query HTTP/1.1" 200 OK
{"q": "We're doing a Flaps 15 takeoff. Remind me, what is the first flap selection we make during retractio", "timestamp": "2025-11-12T18:39:34.780361Z", "level": "info", "event": "Processing query"}
{"num_expansions": 3, "timestamp": "2025-11-12T18:39:51.841605Z", "level": "info", "event": "Query expanded"}
{"dense": 20, "bm25": 20, "timestamp": "2025-11-12T18:39:52.129745Z", "level": "info", "event": "Hybrid retrieval done"}
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  3.24it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  3.24it/s]
{"docs": 10, "timestamp": "2025-11-12T18:39:52.551264Z", "level": "info", "event": "Reranking done"}
{"pages": 1, "timestamp": "2025-11-12T18:40:00.851683Z", "level": "info", "event": "Query done"}
INFO:     127.0.0.1:54363 - "POST /query HTTP/1.1" 200 OK
{"q": "We're planning a Flaps 40 landing on a wet runway at a 1,000-foot pressure altitude airport. If the ", "timestamp": "2025-11-12T18:40:01.377226Z", "level": "info", "event": "Processing query"}
{"num_expansions": 0, "timestamp": "2025-11-12T18:40:19.564811Z", "level": "info", "event": "Query expanded"}
{"dense": 20, "bm25": 20, "timestamp": "2025-11-12T18:40:19.907879Z", "level": "info", "event": "Hybrid retrieval done"}
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  2.95it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  2.94it/s]
{"docs": 10, "timestamp": "2025-11-12T18:40:20.485478Z", "level": "info", "event": "Reranking done"}
{"pages": 1, "timestamp": "2025-11-12T18:40:31.369049Z", "level": "info", "event": "Query done"}
INFO:     127.0.0.1:54383 - "POST /query HTTP/1.1" 200 OK
{"q": "Reviewing the standard takeoff profile: After we're airborne and get a positive rate of climb, what ", "timestamp": "2025-11-12T18:40:31.895310Z", "level": "info", "event": "Processing query"}
{"num_expansions": 3, "timestamp": "2025-11-12T18:40:46.075341Z", "level": "info", "event": "Query expanded"}
{"dense": 20, "bm25": 20, "timestamp": "2025-11-12T18:40:46.362281Z", "level": "info", "event": "Hybrid retrieval done"}
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  2.99it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  2.99it/s]
{"docs": 10, "timestamp": "2025-11-12T18:40:46.792471Z", "level": "info", "event": "Reranking done"}
{"pages": 1, "timestamp": "2025-11-12T18:40:59.215875Z", "level": "info", "event": "Query done"}
INFO:     127.0.0.1:54401 - "POST /query HTTP/1.1" 200 OK
{"q": "Looking at the panel scan responsibilities for when the aircraft is stationary, who is responsible f", "timestamp": "2025-11-12T18:40:59.738317Z", "level": "info", "event": "Processing query"}
{"num_expansions": 3, "timestamp": "2025-11-12T18:41:14.278700Z", "level": "info", "event": "Query expanded"}
{"dense": 20, "bm25": 20, "timestamp": "2025-11-12T18:41:14.582288Z", "level": "info", "event": "Hybrid retrieval done"}
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  2.92it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  2.92it/s]
{"docs": 10, "timestamp": "2025-11-12T18:41:15.191973Z", "level": "info", "event": "Reranking done"}
{"pages": 1, "timestamp": "2025-11-12T18:41:25.538177Z", "level": "info", "event": "Query done"}
INFO:     127.0.0.1:54420 - "POST /query HTTP/1.1" 200 OK
{"q": "For a standard visual pattern, what three actions must be completed prior to turning base?", "timestamp": "2025-11-12T18:41:26.063097Z", "level": "info", "event": "Processing query"}
{"num_expansions": 3, "timestamp": "2025-11-12T18:41:43.142569Z", "level": "info", "event": "Query expanded"}
{"dense": 20, "bm25": 20, "timestamp": "2025-11-12T18:41:43.456559Z", "level": "info", "event": "Hybrid retrieval done"}
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  1.60it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  1.60it/s]
{"docs": 10, "timestamp": "2025-11-12T18:41:44.330527Z", "level": "info", "event": "Reranking done"}
{"pages": 1, "timestamp": "2025-11-12T18:41:57.805158Z", "level": "info", "event": "Query done"}
INFO:     127.0.0.1:56493 - "POST /query HTTP/1.1" 200 OK
{"q": "If the PF is making entries into the CDU during flight, what must the PF do prior to execution?", "timestamp": "2025-11-12T18:41:58.332106Z", "level": "info", "event": "Processing query"}
{"num_expansions": 3, "timestamp": "2025-11-12T18:42:11.440659Z", "level": "info", "event": "Query expanded"}
{"dense": 20, "bm25": 20, "timestamp": "2025-11-12T18:42:11.733517Z", "level": "info", "event": "Hybrid retrieval done"}
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  2.91it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  2.91it/s]
{"docs": 10, "timestamp": "2025-11-12T18:42:12.283424Z", "level": "info", "event": "Reranking done"}
{"pages": 0, "timestamp": "2025-11-12T18:42:31.930530Z", "level": "info", "event": "Query done"}
INFO:     127.0.0.1:57714 - "POST /query HTTP/1.1" 200 OK
{"q": "I see an amber \"STAIRS OPER\" light illuminated on the forward attendant panel; what does that light ", "timestamp": "2025-11-12T18:42:32.474354Z", "level": "info", "event": "Processing query"}
{"num_expansions": 3, "timestamp": "2025-11-12T18:42:46.605462Z", "level": "info", "event": "Query expanded"}
{"dense": 20, "bm25": 20, "timestamp": "2025-11-12T18:42:46.982371Z", "level": "info", "event": "Hybrid retrieval done"}
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  2.82it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  2.82it/s]
{"docs": 10, "timestamp": "2025-11-12T18:42:47.522734Z", "level": "info", "event": "Reranking done"}
{"pages": 1, "timestamp": "2025-11-12T18:42:54.632526Z", "level": "info", "event": "Query done"}
INFO:     127.0.0.1:57747 - "POST /query HTTP/1.1" 200 OK
{"q": "We've just completed the engine start. What is the correct configuration for the ISOLATION VALVE swi", "timestamp": "2025-11-12T18:42:55.163739Z", "level": "info", "event": "Processing query"}
{"num_expansions": 3, "timestamp": "2025-11-12T18:43:06.741718Z", "level": "info", "event": "Query expanded"}
{"dense": 20, "bm25": 20, "timestamp": "2025-11-12T18:43:07.082697Z", "level": "info", "event": "Hybrid retrieval done"}
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  3.12it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  3.12it/s]
{"docs": 10, "timestamp": "2025-11-12T18:43:07.810887Z", "level": "info", "event": "Reranking done"}
{"pages": 1, "timestamp": "2025-11-12T18:43:13.882676Z", "level": "info", "event": "Query done"}
INFO:     127.0.0.1:57765 - "POST /query HTTP/1.1" 200 OK
{"q": "During the Descent and Approach procedure, what action is taken with the AUTO BRAKE select switch , ", "timestamp": "2025-11-12T18:43:14.418765Z", "level": "info", "event": "Processing query"}
{"num_expansions": 3, "timestamp": "2025-11-12T18:43:30.114220Z", "level": "info", "event": "Query expanded"}
{"dense": 20, "bm25": 20, "timestamp": "2025-11-12T18:43:30.403828Z", "level": "info", "event": "Hybrid retrieval done"}
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  3.06it/s]Batches: 100%|██████████| 1/1 [00:00<00:00,  3.06it/s]
{"docs": 10, "timestamp": "2025-11-12T18:43:31.160944Z", "level": "info", "event": "Reranking done"}
{"pages": 2, "timestamp": "2025-11-12T18:43:43.099774Z", "level": "info", "event": "Query done"}
INFO:     127.0.0.1:57799 - "POST /query HTTP/1.1" 200 OK
INFO:     127.0.0.1:65505 - "GET /health HTTP/1.1" 200 OK
